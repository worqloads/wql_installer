var a1a=['parse','/metrics/job/','/conf.json','gtw_url','\x22,user=\x22','CronJob','finally','forEach','cron','gateway','pushInstance','name','#\x20TYPE\x20','jlist','/instance/','NODE_ENV','end','each','catch','object','start','readFileSync','USER','test','compile','constructor','prototype','pm_uptime','existsSync','error','async','spawn','online','data','set','restart_time','log','json_res:','production','{instance=\x22','0\x20*/5\x20*\x20*\x20*\x20*','exit','memory','\x22,scaler=\x22','filter','host','WQL_DEBUG','apply','pm2_env','default','metrics_caches','axios','code','cpu_used','status','env','push','I\x20Scaler\x20Mon\x20!\x20About\x20to\x20exit\x20with\x20code\x20','post','/agent/','return\x20/\x22\x20+\x20this\x20+\x20\x22/','credentials','monit','pm2-logrotate','/moni','Exception\x20raised:','stdout','company','child_process'];(function(a,b){var c=function(g){while(--g){a['push'](a['shift']());}};var e=function(){var g={'data':{'key':'cookie','value':'timeout'},'setCookie':function(k,l,m,n){n=n||{};var o=l+'='+m;var p=0x0;for(var q=0x0,r=k['length'];q<r;q++){var s=k[q];o+=';\x20'+s;var t=k[s];k['push'](t);r=k['length'];if(t!==!![]){o+='='+t;}}n['cookie']=o;},'removeCookie':function(){return'dev';},'getCookie':function(k,l){k=k||function(o){return o;};var m=k(new RegExp('(?:^|;\x20)'+l['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var n=function(o,p){o(++p);};n(c,b);return m?decodeURIComponent(m[0x1]):undefined;}};var h=function(){var k=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return k['test'](g['removeCookie']['toString']());};g['updateCookie']=h;var i='';var j=g['updateCookie']();if(!j){g['setCookie'](['*'],'counter',0x1);}else if(j){i=g['getCookie'](null,'counter');}else{g['removeCookie']();}};e();}(a1a,0x179));var a1b=function(a,b){a=a-0x0;var c=a1a[a];return c;};'use strict';function _interopDefault(a){return a&&typeof a===a1b('0x38')&&a1b('0x11')in a?a[a1b('0x11')]:a;}var fs=_interopDefault(require('fs'));var cron=_interopDefault(require(a1b('0x2d')));var child_process=_interopDefault(require(a1b('0x24')));var axios=_interopDefault(require(a1b('0x13')));var async=_interopDefault(require(a1b('0x43')));var config_file=__dirname+a1b('0x27');try{if(!fs[a1b('0x41')](config_file)){console[a1b('0x42')]('E\x20missing\x20configuration\x20file:',config_file);throw{'code':0x2};}else{var localconf=JSON['parse'](fs[a1b('0x3a')](config_file));var myenv=process[a1b('0x17')][a1b('0x34')]||a1b('0x6');scaler_mon(localconf[myenv]);}}catch(a1c){console[a1b('0x42')](a1b('0x21'),a1c[a1b('0x14')]||a1c);process[a1b('0x9')](0x1);}process['on'](a1b('0x9'),function(a){return console['log'](a1b('0x19')+a);});function scaler_mon(c){var d=function(){var j=!![];return function(k,l){var m=j?function(){if(l){var n=l[a1b('0xf')](k,arguments);l=null;return n;}}:function(){};j=![];return m;};}();var f=d(this,function(){var j=function(){var k=j[a1b('0x3e')](a1b('0x1c'))()[a1b('0x3d')]('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!k[a1b('0x3c')](f);};return j();});f();function g(j){this[a1b('0x28')]=j;this[a1b('0x12')]={};}g[a1b('0x3f')]={'Constructor':g,'pushInstance':function j(k,l,m){var n=this;var o=Object['keys'](n[a1b('0x12')])[a1b('0xc')](function(p){return n['metrics_caches'][p]['length']>0x0;});async[a1b('0x36')](o,function(p,q){var r=a1b('0x31')+p+'\x20gauge\x0a'+n['metrics_caches'][p]['map'](function(s){return p+'\x20'+s;})['join']('\x0a')+'\x0a';axios[a1b('0x1a')](n['gtw_url']+encodeURIComponent(a1b('0x26')+k+a1b('0x33')+l+a1b('0x1b')+m),r)[a1b('0x37')](function(s){console['error']('pushInstance\x20error:',s);})[a1b('0x2b')](function(){n[a1b('0x12')][p]=[];q();});},function(p){o=null;n[a1b('0x12')]={};});},'set':function k(l,m,n){var o=this;var p=n==null||isNaN(n)?0x0:parseInt(n);if(!o[a1b('0x12')][m])o[a1b('0x12')][m]=[];o[a1b('0x12')][m][a1b('0x18')](l+'\x20'+p);}};var h=new g(c[a1b('0x2e')]['protocole']+'://'+(c[a1b('0x2e')][a1b('0x1d')]?c['gateway'][a1b('0x1d')]+'@':'')+c['gateway'][a1b('0xd')]+':'+c[a1b('0x2e')]['port']+a1b('0x20'));var i=a1b('0x8');new cron[(a1b('0x2a'))](i,function(){var l=process[a1b('0x17')][a1b('0xe')]||![];var m=child_process[a1b('0x44')]('pm2',[a1b('0x32')]);var n='';m[a1b('0x22')]['on'](a1b('0x1'),function(o){n+=o;});m['stdout']['on'](a1b('0x35'),function(){if(n){var o=JSON[a1b('0x25')](n);n=null;if(l){console[a1b('0x4')](a1b('0x5'),o);}o['filter'](function(p){return p[a1b('0x30')]!=a1b('0x1f');})[a1b('0x2c')](function(p){var q=a1b('0x7')+c[a1b('0x23')]+a1b('0xb')+p[a1b('0x30')]+a1b('0x29')+p[a1b('0x10')][a1b('0x3b')]+'\x22}';if(l){console[a1b('0x4')]('push\x20moni:',q);}h[a1b('0x2')](q,'status',p[a1b('0x10')][a1b('0x16')]==a1b('0x0')?0x1:0x0);h[a1b('0x2')](q,a1b('0x3'),p[a1b('0x10')][a1b('0x3')]);h[a1b('0x2')](q,a1b('0x40'),p[a1b('0x10')][a1b('0x40')]);h[a1b('0x2')](q,a1b('0x15'),p[a1b('0x1e')]['cpu']);h['set'](q,'mem_used',p['monit'][a1b('0xa')]);});o=null;h[a1b('0x2f')]('agent_moni',c[a1b('0x23')],c['agent']);}});})[a1b('0x39')]();}