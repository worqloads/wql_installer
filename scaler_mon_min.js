var a1a=['/conf.json','/update.sh','cron','staging','\x22,scaler=\x22','unref','\x22,sn=\x22','host','>\x20conf:','company','gtw_url','>\x20API\x20call\x20res:','#\x20TYPE\x20status_up\x20gauge\x0a','scaler_mon','pushInstance','agent_moni','compile','stdout','pm_uptime','status_instance_up','test','axios','E\x20missing\x20configuration\x20file:','://','finally','pm2','detached','catch','push','/moni','process\x20','data','status','#\x20TYPE\x20','prototype','json_res:','Update\x20available\x20-\x20API\x20response:','spawn','/metrics/job/','version','pushUpSAPInstance\x20error:','agent','status_up','\x22,agent=\x22','0\x200\x202\x20*\x20*\x20*','concat','assign','splice','then','#\x20TYPE\x20counter_','length','metrics_caches','online','series','set','counter_','\x20{policy_name=\x22','monit','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','get\x20update\x20error:','child_process','pshgtw::delSerie::error\x20:','\x22,entity_id=\x22','forEach','restart_time','cpu','credentials','default','pushCounter\x20error:','message','pshgtw::del::error\x20:','split','cpu_used','name','\x22\x20}\x20','gateway','https://scaling.worqloads.com/updates','generateGroupings','CronJob','addInstance','\x20gauge\x0a','port','code','round','pm2-logrotate','map','exit','instancenr','no\x20update:','protocole','post','\x22}\x200\x0a','return\x20/\x22\x20+\x20this\x20+\x20\x22/','scaling_up\x20{instance=\x22','env','production','update','assign_hierarchy','up_timeseries','moment','\x20.\x20code\x20exit\x20','start','pm2_env','jlist','error','\x22,sid=\x22','\x22,user=\x22','-a=','replace','pushInstance\x20error:','join','log','keys','delete','#\x20TYPE\x20status_instance_up\x20gauge\x0a','pshgtw::delInstance::error\x20:','async','ignore','format','{instance=\x22','Oops\x20script\x20exec\x20error:','NODE_ENV','WQL_DEBUG','scaling_up','\x22}\x20'];(function(a,b){var c=function(g){while(--g){a['push'](a['shift']());}};var e=function(){var g={'data':{'key':'cookie','value':'timeout'},'setCookie':function(k,l,m,n){n=n||{};var o=l+'='+m;var p=0x0;for(var q=0x0,r=k['length'];q<r;q++){var s=k[q];o+=';\x20'+s;var t=k[s];k['push'](t);r=k['length'];if(t!==!![]){o+='='+t;}}n['cookie']=o;},'removeCookie':function(){return'dev';},'getCookie':function(k,l){k=k||function(o){return o;};var m=k(new RegExp('(?:^|;\x20)'+l['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var n=function(o,p){o(++p);};n(c,b);return m?decodeURIComponent(m[0x1]):undefined;}};var h=function(){var k=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return k['test'](g['removeCookie']['toString']());};g['updateCookie']=h;var i='';var j=g['updateCookie']();if(!j){g['setCookie'](['*'],'counter',0x1);}else if(j){i=g['getCookie'](null,'counter');}else{g['removeCookie']();}};e();}(a1a,0x1a0));var a1b=function(a,b){a=a-0x0;var c=a1a[a];return c;};'use strict';function _interopDefault(c){var d=function(){var g=!![];return function(h,i){var j=g?function(){if(i){var k=i['apply'](h,arguments);i=null;return k;}}:function(){};g=![];return j;};}();var f=d(this,function(){var g=function(){var h=g['constructor'](a1b('0x33'))()[a1b('0x64')](a1b('0x11'));return!h[a1b('0x68')](f);};return g();});f();return c&&typeof c==='object'&&a1b('0x1a')in c?c[a1b('0x1a')]:c;}var child_process=_interopDefault(require(a1b('0x13')));var cron=_interopDefault(require(a1b('0x56')));var axios=_interopDefault(require(a1b('0x69')));var async=_interopDefault(require(a1b('0x4b')));var moment=_interopDefault(require(a1b('0x3a')));var fs$1=_interopDefault(require('fs'));function PushCli(a,b,c){this[a1b('0x7b')]=b;this[a1b('0x57')]=c;this[a1b('0x5e')]=a;this['metrics_caches']={};this[a1b('0x39')]={};}PushCli[a1b('0x76')]={'Constructor':PushCli,'assign_hierarchy':function assign_hierarchy(a,b,c){var d=b[a1b('0x9')]-0x1;for(var f=0x0;f<d;++f){var g=b[f];if(!(g in a)){a[g]={};}a=a[g];}a[b[d]]=c;},'generateGroupings':function generateGroupings(a){var b=this;if(!a&&b[a1b('0x7b')]&&b[a1b('0x57')]){return'/version/'+b['version']+'/staging/'+b[a1b('0x57')];}var c=Object[a1b('0x5')](a,b[a1b('0x7b')]?{'version':b['version']}:{},b['staging']?{'staging':b[a1b('0x57')]}:{});return Object[a1b('0x47')](c)[a1b('0x2c')](function(d){return'/'[a1b('0x4')](encodeURIComponent(d),'/')['concat'](encodeURIComponent(c[d]));})[a1b('0x45')]('');},'addInstance':function addInstance(a){if(!this[a1b('0xa')][a])this['metrics_caches'][a]={};},'pushCounter':function pushCounter(){var a=arguments[a1b('0x9')]>0x0&&arguments[0x0]!==undefined?arguments[0x0]:'counter';var b=arguments[a1b('0x9')]>0x1?arguments[0x1]:undefined;var c=arguments[a1b('0x9')]>0x2?arguments[0x2]:undefined;var d=arguments[a1b('0x9')]>0x3?arguments[0x3]:undefined;var f=arguments['length']>0x4?arguments[0x4]:undefined;var g=arguments[a1b('0x9')]>0x5?arguments[0x5]:undefined;var h=arguments[a1b('0x9')]>0x6?arguments[0x6]:undefined;var i=this;var j={'instance':c,'system_id':d,'instancenr':f};var k=a1b('0x8')+b+a1b('0x27');async[a1b('0xc')]([function(l){if(h==0x1){var m=k+a1b('0xe')+b+a1b('0xf')+g+a1b('0x32');axios['post'](i[a1b('0x5e')]+a1b('0x7a')+encodeURIComponent(a)+i['generateGroupings'](j),m)['catch'](function(n){if(n){console[a1b('0x3f')](a1b('0x1b'),n);}})[a1b('0x6c')](function(){setTimeout(function(){l();},0x61a8);});}else l();},function(l){var m=k+a1b('0xe')+b+a1b('0xf')+g+a1b('0x53')+h+'\x0a';axios[a1b('0x31')](i[a1b('0x5e')]+a1b('0x7a')+encodeURIComponent(a)+i['generateGroupings'](j),m)[a1b('0x6f')](function(n){if(n){console[a1b('0x3f')](a1b('0x1b'),n);}})[a1b('0x6c')](function(){l();});}]);},'pushUpInstance':function pushUpInstance(){var a=arguments[a1b('0x9')]>0x0&&arguments[0x0]!==undefined?arguments[0x0]:'up';var b=arguments[a1b('0x9')]>0x1?arguments[0x1]:undefined;var c=arguments[a1b('0x9')]>0x2?arguments[0x2]:undefined;var d=arguments[a1b('0x9')]>0x3?arguments[0x3]:undefined;var f=arguments['length']>0x4?arguments[0x4]:undefined;var g=arguments[a1b('0x9')]>0x5?arguments[0x5]:undefined;var h=this;var i=h['up_timeseries'][c]&&h[a1b('0x39')][c]['status_up']&&h['up_timeseries'][c][a1b('0x1')][b+'+'+d+'+'+f];if(i==null){h[a1b('0x38')](h['up_timeseries'],[c,a1b('0x1'),b+'+'+d+'+'+f],g);}if(i!==g){var j=a1b('0x60')+'status_up\x20{instance=\x22'+c+a1b('0x15')+b+'\x22,sid=\x22'+f+'\x22,cp_region=\x22'+d+a1b('0x21')+g+'\x0a';axios['post'](h['gtw_url']+a1b('0x7a')+encodeURIComponent(a)+h[a1b('0x24')]({'instance':c}),j)[a1b('0x6f')](function(k){console['error']('pushUpInstance\x20error:',k);});}},'pushUpScaling':function pushUpScaling(){var a=arguments[a1b('0x9')]>0x0&&arguments[0x0]!==undefined?arguments[0x0]:'up';var b=arguments[a1b('0x9')]>0x1?arguments[0x1]:undefined;var c=arguments[a1b('0x9')]>0x2?arguments[0x2]:undefined;var d=arguments['length']>0x3?arguments[0x3]:undefined;var f=this;var g=f[a1b('0x39')][c]&&f[a1b('0x39')][c][a1b('0x52')]&&f['up_timeseries'][c]['scaling_up'][b];if(g==null){f[a1b('0x38')](f[a1b('0x39')],[c,a1b('0x52'),b],d);}if(g!==d){var h='#\x20TYPE\x20scaling_up\x20gauge\x0a'+a1b('0x34')+c+a1b('0x15')+b+'\x22\x20}\x20'+d+'\x0a';axios[a1b('0x31')](f[a1b('0x5e')]+a1b('0x7a')+encodeURIComponent(a)+f['generateGroupings']({'instance':c}),h)[a1b('0x6f')](function(i){console['error']('pushUpScaling\x20error:',i);});}},'pushUpSAPInstance':function pushUpSAPInstance(){var a=arguments[a1b('0x9')]>0x0&&arguments[0x0]!==undefined?arguments[0x0]:'up';var b=arguments[a1b('0x9')]>0x1?arguments[0x1]:undefined;var c=arguments[a1b('0x9')]>0x2?arguments[0x2]:undefined;var d=arguments[a1b('0x9')]>0x3?arguments[0x3]:undefined;var f=arguments[a1b('0x9')]>0x4?arguments[0x4]:undefined;var g=arguments[a1b('0x9')]>0x5?arguments[0x5]:undefined;var h=this;var i='';g[a1b('0x16')](function(j){if(h['up_timeseries'][c]&&h[a1b('0x39')][c][a1b('0x67')]&&h[a1b('0x39')][c][a1b('0x67')][b+'+'+d+'+'+f+'+'+j[a1b('0x2e')]]==null){h[a1b('0x38')](h[a1b('0x39')],[c,a1b('0x67'),b+'+'+d+'+'+f+'+'+j[a1b('0x2e')]],j['status']);}i+='status_instance_up\x20{instance=\x22'+c+a1b('0x15')+b+a1b('0x40')+f+'\x22,cp_region=\x22'+d+a1b('0x5a')+j[a1b('0x2e')]+a1b('0x53')+j[a1b('0x74')]+'\x0a';});if(i!=''){axios[a1b('0x31')](h['gtw_url']+'/metrics/job/'+encodeURIComponent(a)+h[a1b('0x24')]({'instance':c}),a1b('0x49')+i)[a1b('0x6f')](function(j){console[a1b('0x3f')](a1b('0x7c'),j);});}},'pushInstance':function pushInstance(a,b,c){var d=this;if(d['metrics_caches'][b]){var f=Object['keys'](d['metrics_caches'][b])['filter'](function(g){return d[a1b('0xa')][b][g][a1b('0x9')]>0x0;});async['each'](f,function(g,h){var i=a1b('0x75')+g+a1b('0x27')+d[a1b('0xa')][b][g][a1b('0x2c')](function(j){return g+'\x20'+j;})[a1b('0x45')]('\x0a')+'\x0a';axios['post'](d['gtw_url']+'/metrics/job/'+encodeURIComponent(a)+d['generateGroupings']({'instance':b}),i)['then'](function(j){d['metrics_caches'][b][g]=[];h();})[a1b('0x6f')](function(j){d[a1b('0xa')][b][g]=[];h(j);});},function(g){if(g){console[a1b('0x3f')](a1b('0x44'),g);}d[a1b('0xa')][b]={};if(c){c();}});}else if(c){c();}},'set':function set(a,b,c,d){var f=this;var g=b[a1b('0x43')](/-|\(|\)|\[|\]|\%|\+|\.|\s/g,'_');var h=c==null?0x0:isNaN(c)?Math[a1b('0x2a')](parseInt(moment(c,'YYYY/MM/DD\x20hh:mm:ss')[a1b('0x4d')]('X'))):Math['round'](parseInt(c));if(!f[a1b('0xa')][d][g])f['metrics_caches'][d][g]=[];var i=f[a1b('0xa')][d][g][a1b('0x2c')](function(j){return j[a1b('0x1e')]('\x20')[0x0];})['indexOf'](a);if(i>=0x0){f[a1b('0xa')][d][g][a1b('0x6')](i,0x1);}f[a1b('0xa')][d][g][a1b('0x70')](a+'\x20'+h);},'del':function del(a,b){var c=this;axios[a1b('0x48')](c[a1b('0x5e')]+a1b('0x7a')+encodeURIComponent(a)+c[a1b('0x24')]({'instance':b}))[a1b('0x7')](function(d){})[a1b('0x6f')](function(d){console[a1b('0x3f')](a1b('0x1d'),d);});},'delSerie':function delSerie(a,b){var c=this;axios[a1b('0x48')](c[a1b('0x5e')]+a1b('0x7a')+encodeURIComponent(a)+c[a1b('0x24')](b))[a1b('0x7')](function(d){})[a1b('0x6f')](function(d){console[a1b('0x3f')](a1b('0x14'),d);});},'delInstance':function delInstance(a,b){var c=this;axios['delete'](c[a1b('0x5e')]+'/metrics/job/'+encodeURIComponent(a)+c['generateGroupings']({'instance':b}))[a1b('0x7')](function(d){})[a1b('0x6f')](function(d){console[a1b('0x3f')](a1b('0x4a'),d);});}};var pushcli=PushCli;var scaler_utils={'scaler_update':function scaler_update(a){var b=a1b('0x3');var c=a1b('0x23');function d(g,h,i){var j='';g['stderr']['on'](a1b('0x73'),function(k){j+=k;});g['on']('close',function(k){if(k>0x0){console[a1b('0x3f')](a1b('0x72')[a1b('0x4')](h,'\x20.\x20stderr:\x20')[a1b('0x4')](j));console[a1b('0x46')](a1b('0x72')['concat'](h,a1b('0x3b'))[a1b('0x4')](k));i(j);}else{i();}});}function f(g,h,i,j){var k=child_process[a1b('0x79')](g,h,i);if(i&&i[a1b('0x6e')]){k[a1b('0x59')]();}else{d(k,g+'\x20'+h[a1b('0x45')]('\x20'),j);}return k;}new cron[(a1b('0x25'))](b,function(){var g=process[a1b('0x35')]['WQL_DEBUG']||![];if(g){console[a1b('0x46')](a1b('0x5c'),a);}axios[a1b('0x31')](c,{'agent':a['agent'],'version':a[a1b('0x7b')]})['then'](function(h){if(g){console[a1b('0x46')](a1b('0x5f'),h&&h[a1b('0x73')]);}if(h&&h[a1b('0x73')]&&h[a1b('0x73')][a1b('0x37')]==!![]){console[a1b('0x46')](a1b('0x78'),h);f(__dirname+a1b('0x55'),['-v='+h[a1b('0x73')][a1b('0x1c')],a1b('0x42')+a[a1b('0x0')]],{'detached':!![],'stdio':a1b('0x4c')},function(i){if(i)console[a1b('0x3f')](a1b('0x4f'),i);});}else{console[a1b('0x3f')](a1b('0x2f'),h&&h[a1b('0x73')]&&h['data']['message']);}})[a1b('0x6f')](function(h){if(h){console[a1b('0x3f')](a1b('0x12'),h);}});})[a1b('0x3c')]();},'scaler_mon':function scaler_mon(a){var b=pushcli;var c=new b(a[a1b('0x22')][a1b('0x30')]+a1b('0x6b')+(a[a1b('0x22')][a1b('0x19')]?a[a1b('0x22')][a1b('0x19')]+'@':'')+a[a1b('0x22')][a1b('0x5b')]+':'+a[a1b('0x22')][a1b('0x28')]+a1b('0x71'));var d='0\x20*/5\x20*\x20*\x20*\x20*';var f=a[a1b('0x5d')];var g=a[a1b('0x0')];c[a1b('0x26')](f);new cron[(a1b('0x25'))](d,function(){var h=process['env'][a1b('0x51')]||![];var i=child_process['spawn'](a1b('0x6d'),[a1b('0x3e')]);var j='';i[a1b('0x65')]['on']('data',function(k){j+=k;});i['stdout']['on']('end',function(){if(j){var k=JSON['parse'](j);if(h){console[a1b('0x46')](a1b('0x77'),k);}k['filter'](function(l){return l[a1b('0x20')]!=a1b('0x2b');})[a1b('0x16')](function(l){var m=a1b('0x4e')+f+a1b('0x2')+g+a1b('0x58')+l[a1b('0x20')]+a1b('0x41')+l[a1b('0x3d')]['USER']+'\x22}';if(h){console['log']('push\x20moni:',m);}c[a1b('0xd')](m,'status',l[a1b('0x3d')]['status']==a1b('0xb')?0x1:0x0,f);c['set'](m,a1b('0x17'),l[a1b('0x3d')][a1b('0x17')],f);c['set'](m,a1b('0x66'),l[a1b('0x3d')][a1b('0x66')],f);c['set'](m,a1b('0x1f'),l['monit'][a1b('0x18')],f);c[a1b('0xd')](m,'mem_used',l[a1b('0x10')]['memory'],f);});}c[a1b('0x62')](a1b('0x63'),f);});})[a1b('0x3c')]();}};try{var _require=scaler_utils,scaler_mon=_require[a1b('0x61')],fs=fs$1,config_file=__dirname+a1b('0x54');if(!fs['existsSync'](config_file)){console['error'](a1b('0x6a'),config_file);throw{'code':0x2};}else{var localconf=JSON['parse'](fs['readFileSync'](config_file));var myenv=process[a1b('0x35')][a1b('0x50')]||a1b('0x36');scaler_mon(localconf[myenv]);}}catch(a1c){console[a1b('0x3f')]('Exception\x20raised:',a1c[a1b('0x29')]||a1c);process[a1b('0x2d')](0x1);}process['on']('exit',function(a){return console['log']('I\x20Scaler\x20Mon\x20!\x20About\x20to\x20exit\x20with\x20code\x20'+a);});