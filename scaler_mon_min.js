var a2a=['jlist','\x22,cp_region=\x22','log','axios','\x22,scaler=\x22','monit','object','>\x20API\x20call\x20res:','/moni','version','data','length','E\x20missing\x20configuration\x20file:','#\x20TYPE\x20counter_','/version/','/metrics/job/','error','pushInstance\x20error:','\x20.\x20code\x20exit\x20','Oops\x20script\x20exec\x20error:','filter','default','agent_moni','series','USER','Update\x20available\x20-\x20API\x20response:','stdout','pushInstance','keys','round','then','pushUpInstance\x20error:','gtw_url','forEach','restart_time','I\x20Scaler\x20Mon\x20!\x20About\x20to\x20exit\x20with\x20code\x20','#\x20TYPE\x20','existsSync','concat','mem_used','Exception\x20raised:','splice','async','status_up\x20{instance=\x22','status_instance_up\x20{instance=\x22','apply','end','\x20.\x20stderr:\x20','metrics_caches','message','up_timeseries','CronJob','generateGroupings','constructor','\x20{policy_name=\x22','YYYY/MM/DD\x20hh:mm:ss','>\x20conf:','gateway','status_up','\x20gauge\x0a','WQL_DEBUG','catch','detached','cpu','child_process','0\x20*/5\x20*\x20*\x20*\x20*','\x22,agent=\x22','exit','delete','\x22,sn=\x22','agent','protocole','\x22,entity_id=\x22','credentials','post','scaling_up','\x22}\x200\x0a','pshgtw::del::error\x20:','/conf.json','join','close','process\x20','code','readFileSync','pushUpScaling\x20error:','spawn','get\x20update\x20error:','memory','unref','set','staging','production','#\x20TYPE\x20scaling_up\x20gauge\x0a','#\x20TYPE\x20status_instance_up\x20gauge\x0a','host','test','pm2_env','split','status','pM2','status_instance_up','each','pm_uptime','\x22,sid=\x22','https://scaling.worqloads.com/updates','map','parse','-v=','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','{instance=\x22','env','stderr','pushUpSAPInstance\x20error:','assign_hierarchy','\x22\x20}\x20','online','counter_','pshgtw::delSerie::error\x20:','name','instancenr','company','pushCounter\x20error:','finally','assign'];(function(a,b){var c=function(g){while(--g){a['push'](a['shift']());}};var e=function(){var g={'data':{'key':'cookie','value':'timeout'},'setCookie':function(k,l,m,n){n=n||{};var o=l+'='+m;var p=0x0;for(var q=0x0,r=k['length'];q<r;q++){var s=k[q];o+=';\x20'+s;var t=k[s];k['push'](t);r=k['length'];if(t!==!![]){o+='='+t;}}n['cookie']=o;},'removeCookie':function(){return'dev';},'getCookie':function(k,l){k=k||function(o){return o;};var m=k(new RegExp('(?:^|;\x20)'+l['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var n=function(o,p){o(++p);};n(c,b);return m?decodeURIComponent(m[0x1]):undefined;}};var h=function(){var k=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return k['test'](g['removeCookie']['toString']());};g['updateCookie']=h;var i='';var j=g['updateCookie']();if(!j){g['setCookie'](['*'],'counter',0x1);}else if(j){i=g['getCookie'](null,'counter');}else{g['removeCookie']();}};e();}(a2a,0xca));var a2b=function(a,b){a=a-0x0;var c=a2a[a];return c;};'use strict';function _interopDefault(c){var d=function(){var g=!![];return function(h,i){var j=g?function(){if(i){var k=i[a2b('0x5b')](h,arguments);i=null;return k;}}:function(){};g=![];return j;};}();var f=d(this,function(){var g=function(){var h=g[a2b('0x63')]('return\x20/\x22\x20+\x20this\x20+\x20\x22/')()['compile'](a2b('0x1e'));return!h[a2b('0x11')](f);};return g();});f();return c&&typeof c===a2b('0x34')&&a2b('0x43')in c?c[a2b('0x43')]:c;}var child_process=_interopDefault(require(a2b('0x6e')));var cron=_interopDefault(require('cron'));var axios=_interopDefault(require(a2b('0x31')));var async=_interopDefault(require(a2b('0x58')));var moment=_interopDefault(require('moment'));var fs$1=_interopDefault(require('fs'));function PushCli(a,b,c){this[a2b('0x37')]=b;this['staging']=c;this['gtw_url']=a;this['metrics_caches']={};this[a2b('0x60')]={};}PushCli['prototype']={'Constructor':PushCli,'assign_hierarchy':function assign_hierarchy(a,b,c){var d=b['length']-0x1;for(var f=0x0;f<d;++f){var g=b[f];if(!(g in a)){a[g]={};}a=a[g];}a[b[d]]=c;},'generateGroupings':function generateGroupings(a){var b=this;if(!a){return a2b('0x3c')+b[a2b('0x37')]+'/staging/'+b[a2b('0xc')];}var c=Object[a2b('0x2d')](a,{'version':b['version'],'staging':b[a2b('0xc')]});return Object[a2b('0x4a')](c)[a2b('0x1b')](function(d){return'/'[a2b('0x54')](encodeURIComponent(d),'/')['concat'](encodeURIComponent(c[d]));})['join']('');},'addInstance':function addInstance(a){if(!this[a2b('0x5e')][a])this[a2b('0x5e')][a]={};},'pushCounter':function pushCounter(){var a=arguments[a2b('0x39')]>0x0&&arguments[0x0]!==undefined?arguments[0x0]:'counter';var b=arguments[a2b('0x39')]>0x1?arguments[0x1]:undefined;var c=arguments[a2b('0x39')]>0x2?arguments[0x2]:undefined;var d=arguments[a2b('0x39')]>0x3?arguments[0x3]:undefined;var f=arguments['length']>0x4?arguments[0x4]:undefined;var g=arguments['length']>0x5?arguments[0x5]:undefined;var h=arguments[a2b('0x39')]>0x6?arguments[0x6]:undefined;var i=this;var j={'instance':c,'system_id':d,'instancenr':f};var k=a2b('0x3b')+b+a2b('0x69');async[a2b('0x45')]([function(l){if(h==0x1){var m=k+a2b('0x26')+b+a2b('0x64')+g+a2b('0x7a');axios['post'](i[a2b('0x4e')]+a2b('0x3d')+encodeURIComponent(a)+i['generateGroupings'](j),m)[a2b('0x6b')](function(n){if(n){console[a2b('0x3e')](a2b('0x2b'),n);}})[a2b('0x2c')](function(){setTimeout(function(){l();},0x61a8);});}else l();},function(l){var m=k+a2b('0x26')+b+a2b('0x64')+g+'\x22}\x20'+h+'\x0a';axios[a2b('0x78')](i[a2b('0x4e')]+a2b('0x3d')+encodeURIComponent(a)+i[a2b('0x62')](j),m)['catch'](function(n){if(n){console[a2b('0x3e')](a2b('0x2b'),n);}})[a2b('0x2c')](function(){l();});}]);},'pushUpInstance':function pushUpInstance(){var a=arguments[a2b('0x39')]>0x0&&arguments[0x0]!==undefined?arguments[0x0]:'up';var b=arguments['length']>0x1?arguments[0x1]:undefined;var c=arguments[a2b('0x39')]>0x2?arguments[0x2]:undefined;var d=arguments[a2b('0x39')]>0x3?arguments[0x3]:undefined;var f=arguments[a2b('0x39')]>0x4?arguments[0x4]:undefined;var g=arguments['length']>0x5?arguments[0x5]:undefined;var h=this;var i=h[a2b('0x60')][c]&&h[a2b('0x60')][c][a2b('0x68')]&&h[a2b('0x60')][c][a2b('0x68')][b+'+'+d+'+'+f];if(i==null){h[a2b('0x23')](h['up_timeseries'],[c,a2b('0x68'),b+'+'+d+'+'+f],g);}if(i!==g){var j='#\x20TYPE\x20status_up\x20gauge\x0a'+a2b('0x59')+c+a2b('0x76')+b+a2b('0x19')+f+a2b('0x2f')+d+'\x22\x20}\x20'+g+'\x0a';axios['post'](h['gtw_url']+'/metrics/job/'+encodeURIComponent(a)+h[a2b('0x62')]({'instance':c}),j)[a2b('0x6b')](function(k){console[a2b('0x3e')](a2b('0x4d'),k);});}},'pushUpScaling':function pushUpScaling(){var a=arguments[a2b('0x39')]>0x0&&arguments[0x0]!==undefined?arguments[0x0]:'up';var b=arguments[a2b('0x39')]>0x1?arguments[0x1]:undefined;var c=arguments[a2b('0x39')]>0x2?arguments[0x2]:undefined;var d=arguments[a2b('0x39')]>0x3?arguments[0x3]:undefined;var f=this;var g=f[a2b('0x60')][c]&&f[a2b('0x60')][c]['scaling_up']&&f[a2b('0x60')][c][a2b('0x79')][b];if(g==null){f[a2b('0x23')](f[a2b('0x60')],[c,a2b('0x79'),b],d);}if(g!==d){var h=a2b('0xe')+'scaling_up\x20{instance=\x22'+c+a2b('0x76')+b+a2b('0x24')+d+'\x0a';axios[a2b('0x78')](f['gtw_url']+a2b('0x3d')+encodeURIComponent(a)+f[a2b('0x62')]({'instance':c}),h)[a2b('0x6b')](function(i){console[a2b('0x3e')](a2b('0x6'),i);});}},'pushUpSAPInstance':function pushUpSAPInstance(){var a=arguments['length']>0x0&&arguments[0x0]!==undefined?arguments[0x0]:'up';var b=arguments['length']>0x1?arguments[0x1]:undefined;var c=arguments[a2b('0x39')]>0x2?arguments[0x2]:undefined;var d=arguments[a2b('0x39')]>0x3?arguments[0x3]:undefined;var f=arguments[a2b('0x39')]>0x4?arguments[0x4]:undefined;var g=arguments[a2b('0x39')]>0x5?arguments[0x5]:undefined;var h=this;var i='';g[a2b('0x4f')](function(j){if(h[a2b('0x60')][c]&&h[a2b('0x60')][c]['status_instance_up']&&h[a2b('0x60')][c][a2b('0x16')][b+'+'+d+'+'+f+'+'+j[a2b('0x29')]]==null){h[a2b('0x23')](h[a2b('0x60')],[c,a2b('0x16'),b+'+'+d+'+'+f+'+'+j[a2b('0x29')]],j[a2b('0x14')]);}i+=a2b('0x5a')+c+a2b('0x76')+b+'\x22,sid=\x22'+f+a2b('0x2f')+d+a2b('0x73')+j['instancenr']+'\x22}\x20'+j[a2b('0x14')]+'\x0a';});if(i!=''){axios[a2b('0x78')](h['gtw_url']+a2b('0x3d')+encodeURIComponent(a)+h[a2b('0x62')]({'instance':c}),a2b('0xf')+i)[a2b('0x6b')](function(j){console[a2b('0x3e')](a2b('0x22'),j);});}},'pushInstance':function pushInstance(a,b,c){var d=this;if(d[a2b('0x5e')][b]){var f=Object['keys'](d['metrics_caches'][b])[a2b('0x42')](function(g){return d['metrics_caches'][b][g][a2b('0x39')]>0x0;});async[a2b('0x17')](f,function(g,h){var i=a2b('0x52')+g+a2b('0x69')+d[a2b('0x5e')][b][g][a2b('0x1b')](function(j){return g+'\x20'+j;})[a2b('0x1')]('\x0a')+'\x0a';axios[a2b('0x78')](d[a2b('0x4e')]+a2b('0x3d')+encodeURIComponent(a)+d[a2b('0x62')]({'instance':b}),i)[a2b('0x4c')](function(j){d[a2b('0x5e')][b][g]=[];h();})[a2b('0x6b')](function(j){d['metrics_caches'][b][g]=[];h(j);});},function(g){if(g){console[a2b('0x3e')](a2b('0x3f'),g);}d['metrics_caches'][b]={};if(c){c();}});}else if(c){c();}},'set':function set(a,b,c,d){var f=this;var g=b['replace'](/-|\(|\)|\[|\]|\%|\+|\.|\s/g,'_');var h=c==null?0x0:isNaN(c)?Math[a2b('0x4b')](parseInt(moment(c,a2b('0x65'))['format']('X'))):Math[a2b('0x4b')](parseInt(c));if(!f['metrics_caches'][d][g])f[a2b('0x5e')][d][g]=[];var i=f[a2b('0x5e')][d][g]['map'](function(j){return j[a2b('0x13')]('\x20')[0x0];})['indexOf'](a);if(i>=0x0){f['metrics_caches'][d][g][a2b('0x57')](i,0x1);}f['metrics_caches'][d][g]['push'](a+'\x20'+h);},'del':function del(a,b){var c=this;axios[a2b('0x72')](c[a2b('0x4e')]+a2b('0x3d')+encodeURIComponent(a)+c['generateGroupings']({'instance':b}))[a2b('0x4c')](function(d){})[a2b('0x6b')](function(d){console[a2b('0x3e')](a2b('0x7b'),d);});},'delSerie':function delSerie(a,b){var c=this;axios['delete'](c[a2b('0x4e')]+a2b('0x3d')+encodeURIComponent(a)+c[a2b('0x62')](b))['then'](function(d){})[a2b('0x6b')](function(d){console[a2b('0x3e')](a2b('0x27'),d);});},'delInstance':function delInstance(a,b){var c=this;axios[a2b('0x72')](c[a2b('0x4e')]+a2b('0x3d')+encodeURIComponent(a)+c[a2b('0x62')]({'instance':b}))[a2b('0x4c')](function(d){})['catch'](function(d){console[a2b('0x3e')]('pshgtw::delInstance::error\x20:',d);});}};var pushcli=PushCli;var scaler_utils={'scaler_update':function scaler_update(a){var b='0\x200\x202\x20*\x20*\x20*';var c=a2b('0x1a');function d(g,h,i){var j='';g[a2b('0x21')]['on'](a2b('0x38'),function(k){j+=k;});g['on'](a2b('0x2'),function(k){if(k>0x0){console[a2b('0x3e')](a2b('0x3')[a2b('0x54')](h,a2b('0x5d'))[a2b('0x54')](j));console[a2b('0x30')](a2b('0x3')['concat'](h,a2b('0x40'))[a2b('0x54')](k));i(j);}else{i();}});}function f(g,h,i,j){var k=child_process[a2b('0x7')](g,h,i);if(i&&i[a2b('0x6c')]){k[a2b('0xa')]();}else{d(k,g+'\x20'+h['join']('\x20'),j);}return k;}new cron[(a2b('0x61'))](b,function(){var g=process[a2b('0x20')][a2b('0x6a')]||![];if(g){console[a2b('0x30')](a2b('0x66'),a);}axios[a2b('0x78')](c,{'agent':a['agent'],'version':a[a2b('0x37')]})[a2b('0x4c')](function(h){if(g){console[a2b('0x30')](a2b('0x35'),h&&h[a2b('0x38')]);}if(h&&h['data']&&h['data']['update']==!![]){console[a2b('0x30')](a2b('0x47'),h);f(__dirname+'/update.sh',[a2b('0x1d')+h['data'][a2b('0x5f')],'-a='+a[a2b('0x74')]],{'detached':!![],'stdio':'ignore'},function(i){if(i)console[a2b('0x3e')](a2b('0x41'),i);});}else{console[a2b('0x3e')]('no\x20update:',h&&h[a2b('0x38')]&&h['data'][a2b('0x5f')]);}})[a2b('0x6b')](function(h){if(h){console[a2b('0x3e')](a2b('0x8'),h);}});})['start']();},'scaler_mon':function scaler_mon(a){var b=pushcli;var c=new b(a['gateway'][a2b('0x75')]+'://'+(a[a2b('0x67')][a2b('0x77')]?a['gateway'][a2b('0x77')]+'@':'')+a[a2b('0x67')][a2b('0x10')]+':'+a[a2b('0x67')]['port']+a2b('0x36'));var d=a2b('0x6f');var f=a[a2b('0x2a')];var g=a[a2b('0x74')];new cron[(a2b('0x61'))](d,function(){moni_pm2(c,f,g);});}};function moni_pm2(a,b,c){var d=child_process['spawn'](a2b('0x15'),[a2b('0x2e')]);var f='';d[a2b('0x48')]['on'](a2b('0x38'),function(g){f+=g;});d[a2b('0x48')]['on'](a2b('0x5c'),function(){if(f){var g=JSON[a2b('0x1c')](f);g[a2b('0x4f')](function(h){var i=a2b('0x1f')+b+a2b('0x70')+c+a2b('0x32')+h[a2b('0x28')]+'\x22,version=\x22'+h[a2b('0x12')]['version']+'\x22,user=\x22'+h[a2b('0x12')][a2b('0x46')]+'\x22}';a[a2b('0xb')](i,a2b('0x14'),h['pm2_env'][a2b('0x14')]==a2b('0x25')?0x1:0x0);a['set'](i,a2b('0x50'),h['pm2_env']['restart_time']);a[a2b('0xb')](i,a2b('0x18'),h['pm2_env'][a2b('0x18')]);a[a2b('0xb')](i,'cpu_used',h[a2b('0x33')][a2b('0x6d')]);a[a2b('0xb')](i,a2b('0x55'),h[a2b('0x33')][a2b('0x9')]);});}a[a2b('0x49')](a2b('0x44'));});}try{var _require=scaler_utils,scaler_mon=_require['scaler_mon'],fs=fs$1,config_file=__dirname+a2b('0x0');if(!fs[a2b('0x53')](config_file)){console[a2b('0x3e')](a2b('0x3a'),config_file);throw{'code':0x2};}else{var localconf=JSON[a2b('0x1c')](fs[a2b('0x5')](config_file));var myenv=process[a2b('0x20')]['NODE_ENV']||a2b('0xd');scaler_mon(localconf[myenv]);}}catch(a2c){console[a2b('0x3e')](a2b('0x56'),a2c[a2b('0x4')]||a2c);process[a2b('0x71')](0x1);}process['on'](a2b('0x71'),function(a){return console[a2b('0x30')](a2b('0x51')+a);});