var a1a=['status_up','pushInstance\x20error:','-v=','round','{instance=\x22','cpu_used','WQL_DEBUG','format','/update.sh','\x22,sid=\x22','production','\x22}\x20','length','NODE_ENV','Update\x20available\x20-\x20API\x20response:','\x22,agent=\x22','\x22,entity_id=\x22','addInstance','log','message','I\x20Scaler\x20Mon\x20!\x20About\x20to\x20exit\x20with\x20code\x20','return\x20/\x22\x20+\x20this\x20+\x20\x22/','spawn','YYYY/MM/DD\x20hh:mm:ss','pshgtw::delInstance::error\x20:','version','scaler_mon','parse','memory','protocole','assign_hierarchy','split','child_process','0\x20*\x20*\x20*\x20*\x20*','Oops\x20script\x20exec\x20error:','forEach','agent','join','each','\x22,user=\x22','instancenr','gtw_url','counter_','E\x20missing\x20configuration\x20file:','update','delete','gateway','pushUpSAPInstance\x20error:','CronJob','process\x20','pshgtw::delSerie::error\x20:','status_instance_up','restart_time','existsSync','host','map','jlist','/version/','finally','stdout','error','close','scaling_up','>\x20API\x20call\x20res:','/metrics/job/','filter','\x20.\x20stderr:\x20','/conf.json','push\x20moni:','env','series','pM2','\x22,version=\x22','pushUpScaling\x20error:','no\x20update:','#\x20TYPE\x20scaling_up\x20gauge\x0a','pushUpInstance\x20error:','scaling_up\x20{instance=\x22','object','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','pshgtw::del::error\x20:','#\x20TYPE\x20','pm_uptime','staging','Exception\x20raised:','get\x20update\x20error:','moment','status_up\x20{instance=\x22','replace','company','code','push','pm2_env','\x20.\x20code\x20exit\x20','\x20gauge\x0a','cpu','end','async','readFileSync','\x20{policy_name=\x22','-a=','assign','https://scaling.worqloads.com/updates','concat','\x22,sn=\x22','data','axios','keys','then','\x22,scaler=\x22','apply','\x22}\x200\x0a','\x22,cp_region=\x22','#\x20TYPE\x20status_up\x20gauge\x0a','ignore','metrics_caches','online','>\x20conf:','generateGroupings','credentials','splice','constructor','indexOf','up_timeseries','agent_moni','set','catch','monit','status','mem_used','exit','pushCounter\x20error:','0\x200\x202\x20*\x20*\x20*','post','/moni'];(function(a,b){var c=function(g){while(--g){a['push'](a['shift']());}};var e=function(){var g={'data':{'key':'cookie','value':'timeout'},'setCookie':function(k,l,m,n){n=n||{};var o=l+'='+m;var p=0x0;for(var q=0x0,r=k['length'];q<r;q++){var s=k[q];o+=';\x20'+s;var t=k[s];k['push'](t);r=k['length'];if(t!==!![]){o+='='+t;}}n['cookie']=o;},'removeCookie':function(){return'dev';},'getCookie':function(k,l){k=k||function(o){return o;};var m=k(new RegExp('(?:^|;\x20)'+l['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var n=function(o,p){o(++p);};n(c,b);return m?decodeURIComponent(m[0x1]):undefined;}};var h=function(){var k=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return k['test'](g['removeCookie']['toString']());};g['updateCookie']=h;var i='';var j=g['updateCookie']();if(!j){g['setCookie'](['*'],'counter',0x1);}else if(j){i=g['getCookie'](null,'counter');}else{g['removeCookie']();}};e();}(a1a,0x145));var a1b=function(a,b){a=a-0x0;var c=a1a[a];return c;};'use strict';function _interopDefault(c){var d=function(){var g=!![];return function(h,i){var j=g?function(){if(i){var k=i[a1b('0x37')](h,arguments);i=null;return k;}}:function(){};g=![];return j;};}();var f=d(this,function(){var g=function(){var h=g[a1b('0x42')](a1b('0x65'))()['compile'](a1b('0x18'));return!h['test'](f);};return g();});f();return c&&typeof c===a1b('0x17')&&'default'in c?c['default']:c;}var child_process=_interopDefault(require(a1b('0x70')));var cron=_interopDefault(require('cron'));var axios=_interopDefault(require(a1b('0x33')));var async=_interopDefault(require(a1b('0x2a')));var moment=_interopDefault(require(a1b('0x1f')));var fs$1=_interopDefault(require('fs'));function PushCli(a,b,c){this[a1b('0x69')]=b;this['staging']=c;this[a1b('0x79')]=a;this[a1b('0x3c')]={};this['up_timeseries']={};}PushCli['prototype']={'Constructor':PushCli,'assign_hierarchy':function assign_hierarchy(a,b,c){var d=b[a1b('0x5c')]-0x1;for(var f=0x0;f<d;++f){var g=b[f];if(!(g in a)){a[g]={};}a=a[g];}a[b[d]]=c;},'generateGroupings':function generateGroupings(a){var b=this;if(!a){return a1b('0x2')+b['version']+'/staging/'+b[a1b('0x1c')];}var c=Object[a1b('0x2e')](a,{'version':b[a1b('0x69')],'staging':b[a1b('0x1c')]});return Object[a1b('0x34')](c)[a1b('0x0')](function(d){return'/'['concat'](encodeURIComponent(d),'/')[a1b('0x30')](encodeURIComponent(c[d]));})[a1b('0x75')]('');},'addInstance':function addInstance(a){if(!this['metrics_caches'][a])this['metrics_caches'][a]={};},'pushCounter':function pushCounter(){var a=arguments[a1b('0x5c')]>0x0&&arguments[0x0]!==undefined?arguments[0x0]:'counter';var b=arguments[a1b('0x5c')]>0x1?arguments[0x1]:undefined;var c=arguments[a1b('0x5c')]>0x2?arguments[0x2]:undefined;var d=arguments[a1b('0x5c')]>0x3?arguments[0x3]:undefined;var f=arguments[a1b('0x5c')]>0x4?arguments[0x4]:undefined;var g=arguments[a1b('0x5c')]>0x5?arguments[0x5]:undefined;var h=arguments[a1b('0x5c')]>0x6?arguments[0x6]:undefined;var i=this;var j={'instance':c,'system_id':d,'instancenr':f};var k='#\x20TYPE\x20counter_'+b+a1b('0x27');async[a1b('0xf')]([function(l){if(h==0x1){var m=k+'counter_'+b+a1b('0x2c')+g+a1b('0x38');axios[a1b('0x4e')](i[a1b('0x79')]+a1b('0x9')+encodeURIComponent(a)+i[a1b('0x3f')](j),m)[a1b('0x47')](function(n){if(n){console[a1b('0x5')](a1b('0x4c'),n);}})[a1b('0x3')](function(){setTimeout(function(){l();},0x61a8);});}else l();},function(l){var m=k+a1b('0x7a')+b+a1b('0x2c')+g+a1b('0x5b')+h+'\x0a';axios[a1b('0x4e')](i[a1b('0x79')]+'/metrics/job/'+encodeURIComponent(a)+i['generateGroupings'](j),m)[a1b('0x47')](function(n){if(n){console[a1b('0x5')](a1b('0x4c'),n);}})[a1b('0x3')](function(){l();});}]);},'pushUpInstance':function pushUpInstance(){var a=arguments[a1b('0x5c')]>0x0&&arguments[0x0]!==undefined?arguments[0x0]:'up';var b=arguments[a1b('0x5c')]>0x1?arguments[0x1]:undefined;var c=arguments['length']>0x2?arguments[0x2]:undefined;var d=arguments[a1b('0x5c')]>0x3?arguments[0x3]:undefined;var f=arguments['length']>0x4?arguments[0x4]:undefined;var g=arguments[a1b('0x5c')]>0x5?arguments[0x5]:undefined;var h=this;var i=h[a1b('0x44')][c]&&h[a1b('0x44')][c]['status_up']&&h[a1b('0x44')][c][a1b('0x50')][b+'+'+d+'+'+f];if(i==null){h[a1b('0x6e')](h['up_timeseries'],[c,a1b('0x50'),b+'+'+d+'+'+f],g);}if(i!==g){var j=a1b('0x3a')+a1b('0x20')+c+a1b('0x60')+b+a1b('0x59')+f+a1b('0x39')+d+'\x22\x20}\x20'+g+'\x0a';axios[a1b('0x4e')](h[a1b('0x79')]+'/metrics/job/'+encodeURIComponent(a)+h['generateGroupings']({'instance':c}),j)[a1b('0x47')](function(k){console[a1b('0x5')](a1b('0x15'),k);});}},'pushUpScaling':function pushUpScaling(){var a=arguments[a1b('0x5c')]>0x0&&arguments[0x0]!==undefined?arguments[0x0]:'up';var b=arguments[a1b('0x5c')]>0x1?arguments[0x1]:undefined;var c=arguments[a1b('0x5c')]>0x2?arguments[0x2]:undefined;var d=arguments[a1b('0x5c')]>0x3?arguments[0x3]:undefined;var f=this;var g=f[a1b('0x44')][c]&&f[a1b('0x44')][c]['scaling_up']&&f[a1b('0x44')][c][a1b('0x7')][b];if(g==null){f[a1b('0x6e')](f['up_timeseries'],[c,a1b('0x7'),b],d);}if(g!==d){var h=a1b('0x14')+a1b('0x16')+c+a1b('0x60')+b+'\x22\x20}\x20'+d+'\x0a';axios[a1b('0x4e')](f[a1b('0x79')]+'/metrics/job/'+encodeURIComponent(a)+f[a1b('0x3f')]({'instance':c}),h)['catch'](function(i){console[a1b('0x5')](a1b('0x12'),i);});}},'pushUpSAPInstance':function pushUpSAPInstance(){var a=arguments[a1b('0x5c')]>0x0&&arguments[0x0]!==undefined?arguments[0x0]:'up';var b=arguments[a1b('0x5c')]>0x1?arguments[0x1]:undefined;var c=arguments[a1b('0x5c')]>0x2?arguments[0x2]:undefined;var d=arguments['length']>0x3?arguments[0x3]:undefined;var f=arguments[a1b('0x5c')]>0x4?arguments[0x4]:undefined;var g=arguments[a1b('0x5c')]>0x5?arguments[0x5]:undefined;var h=this;var i='';g[a1b('0x73')](function(j){if(h[a1b('0x44')][c]&&h[a1b('0x44')][c][a1b('0x83')]&&h[a1b('0x44')][c][a1b('0x83')][b+'+'+d+'+'+f+'+'+j[a1b('0x78')]]==null){h[a1b('0x6e')](h[a1b('0x44')],[c,a1b('0x83'),b+'+'+d+'+'+f+'+'+j[a1b('0x78')]],j['status']);}i+='status_instance_up\x20{instance=\x22'+c+a1b('0x60')+b+a1b('0x59')+f+a1b('0x39')+d+a1b('0x31')+j[a1b('0x78')]+a1b('0x5b')+j['status']+'\x0a';});if(i!=''){axios[a1b('0x4e')](h['gtw_url']+a1b('0x9')+encodeURIComponent(a)+h[a1b('0x3f')]({'instance':c}),'#\x20TYPE\x20status_instance_up\x20gauge\x0a'+i)[a1b('0x47')](function(j){console[a1b('0x5')](a1b('0x7f'),j);});}},'pushInstance':function pushInstance(a,b,c){var d=this;if(d[a1b('0x3c')][b]){var f=Object[a1b('0x34')](d['metrics_caches'][b])[a1b('0xa')](function(g){return d[a1b('0x3c')][b][g][a1b('0x5c')]>0x0;});async[a1b('0x76')](f,function(g,h){var i=a1b('0x1a')+g+a1b('0x27')+d[a1b('0x3c')][b][g][a1b('0x0')](function(j){return g+'\x20'+j;})['join']('\x0a')+'\x0a';axios[a1b('0x4e')](d[a1b('0x79')]+a1b('0x9')+encodeURIComponent(a)+d[a1b('0x3f')]({'instance':b}),i)[a1b('0x35')](function(j){d[a1b('0x3c')][b][g]=[];h();})[a1b('0x47')](function(j){d[a1b('0x3c')][b][g]=[];h(j);});},function(g){if(g){console[a1b('0x5')](a1b('0x51'),g);}d[a1b('0x3c')][b]={};if(c){c();}});}else if(c){c();}},'set':function set(a,b,c,d){var f=this;var g=b[a1b('0x21')](/-|\(|\)|\[|\]|\%|\+|\.|\s/g,'_');var h=c==null?0x0:isNaN(c)?Math[a1b('0x53')](parseInt(moment(c,a1b('0x67'))[a1b('0x57')]('X'))):Math['round'](parseInt(c));if(!f['metrics_caches'][d][g])f[a1b('0x3c')][d][g]=[];var i=f[a1b('0x3c')][d][g][a1b('0x0')](function(j){return j[a1b('0x6f')]('\x20')[0x0];})[a1b('0x43')](a);if(i>=0x0){f[a1b('0x3c')][d][g][a1b('0x41')](i,0x1);}f[a1b('0x3c')][d][g][a1b('0x24')](a+'\x20'+h);},'del':function del(a,b){var c=this;axios[a1b('0x7d')](c[a1b('0x79')]+a1b('0x9')+encodeURIComponent(a)+c[a1b('0x3f')]({'instance':b}))['then'](function(d){})['catch'](function(d){console[a1b('0x5')](a1b('0x19'),d);});},'delSerie':function delSerie(a,b){var c=this;axios[a1b('0x7d')](c[a1b('0x79')]+a1b('0x9')+encodeURIComponent(a)+c['generateGroupings'](b))[a1b('0x35')](function(d){})[a1b('0x47')](function(d){console[a1b('0x5')](a1b('0x82'),d);});},'delInstance':function delInstance(a,b){var c=this;axios[a1b('0x7d')](c[a1b('0x79')]+a1b('0x9')+encodeURIComponent(a)+c[a1b('0x3f')]({'instance':b}))['then'](function(d){})['catch'](function(d){console[a1b('0x5')](a1b('0x68'),d);});}};var pushcli=PushCli;var scaler_utils={'scaler_update':function scaler_update(a){var b=a1b('0x4d');var c=a1b('0x2f');function d(g,h,i){var j='';g['stderr']['on'](a1b('0x32'),function(k){j+=k;});g['on'](a1b('0x6'),function(k){if(k>0x0){console[a1b('0x5')](a1b('0x81')[a1b('0x30')](h,a1b('0xb'))[a1b('0x30')](j));console[a1b('0x62')](a1b('0x81')[a1b('0x30')](h,a1b('0x26'))[a1b('0x30')](k));i(j);}else{i();}});}function f(g,h,i,j){var k=child_process['spawn'](g,h,i);if(i&&i['detached']){k['unref']();}else{d(k,g+'\x20'+h['join']('\x20'),j);}return k;}new cron['CronJob'](b,function(){var g=process[a1b('0xe')][a1b('0x56')]||![];if(g){console[a1b('0x62')](a1b('0x3e'),a);}axios[a1b('0x4e')](c,{'agent':a[a1b('0x74')],'version':a['version']})[a1b('0x35')](function(h){if(g){console[a1b('0x62')](a1b('0x8'),h&&h[a1b('0x32')]);}if(h&&h[a1b('0x32')]&&h[a1b('0x32')][a1b('0x7c')]==!![]){console['log'](a1b('0x5e'),h);f(__dirname+a1b('0x58'),[a1b('0x52')+h[a1b('0x32')][a1b('0x63')],a1b('0x2d')+a['agent']],{'detached':!![],'stdio':a1b('0x3b')},function(i){if(i)console['error'](a1b('0x72'),i);});}else{console[a1b('0x5')](a1b('0x13'),h&&h[a1b('0x32')]&&h[a1b('0x32')]['message']);}})[a1b('0x47')](function(h){if(h){console[a1b('0x5')](a1b('0x1e'),h);}});})['start']();},'scaler_mon':function scaler_mon(a){var b=pushcli;var c=new b(a[a1b('0x7e')][a1b('0x6d')]+'://'+(a[a1b('0x7e')][a1b('0x40')]?a[a1b('0x7e')]['credentials']+'@':'')+a['gateway'][a1b('0x86')]+':'+a['gateway']['port']+a1b('0x4f'));var d=a1b('0x71');var f=a[a1b('0x22')];var g=a[a1b('0x74')];c[a1b('0x61')](f);new cron[(a1b('0x80'))](d,function(){var h=i[a1b('0xe')][a1b('0x56')]||![];var i=child_process[a1b('0x66')](a1b('0x10'),[a1b('0x1')]);var j='';i[a1b('0x4')]['on'](a1b('0x32'),function(k){j+=k;});i[a1b('0x4')]['on'](a1b('0x29'),function(){if(j){var k=JSON[a1b('0x6b')](j);if(h){console[a1b('0x62')]('json_res:',k);}k['forEach'](function(l){var m=a1b('0x54')+f+a1b('0x5f')+g+a1b('0x36')+l['name']+a1b('0x11')+l[a1b('0x25')][a1b('0x69')]+a1b('0x77')+l[a1b('0x25')]['USER']+'\x22}';if(h){console[a1b('0x62')](a1b('0xd'),m);}c['set'](m,a1b('0x49'),l[a1b('0x25')][a1b('0x49')]==a1b('0x3d')?0x1:0x0);c[a1b('0x46')](m,a1b('0x84'),l['pm2_env'][a1b('0x84')]);c[a1b('0x46')](m,a1b('0x1b'),l[a1b('0x25')][a1b('0x1b')]);c[a1b('0x46')](m,a1b('0x55'),l[a1b('0x48')][a1b('0x28')]);c[a1b('0x46')](m,a1b('0x4a'),l[a1b('0x48')][a1b('0x6c')]);});}c['pushInstance'](a1b('0x45'));});});}};try{var _require=scaler_utils,scaler_mon=_require[a1b('0x6a')],fs=fs$1,config_file=__dirname+a1b('0xc');if(!fs[a1b('0x85')](config_file)){console[a1b('0x5')](a1b('0x7b'),config_file);throw{'code':0x2};}else{var localconf=JSON[a1b('0x6b')](fs[a1b('0x2b')](config_file));var myenv=process[a1b('0xe')][a1b('0x5d')]||a1b('0x5a');scaler_mon(localconf[myenv]);}}catch(a1c){console['error'](a1b('0x1d'),a1c[a1b('0x23')]||a1c);process['exit'](0x1);}process['on'](a1b('0x4b'),function(a){return console[a1b('0x62')](a1b('0x64')+a);});
